(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{689:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var n=a(7876),r=a(4232),s=a(2226);function l(e){let{setActiveTab:t,isOpen:a,onClose:l}=e,[i,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(0);(0,r.useEffect)(()=>{let e=localStorage.getItem("user");e&&o(JSON.parse(e).role||"employee")},[]);let u=()=>{let e=localStorage.getItem("token");e&&fetch("".concat(s.A,"/api/Pending"),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.json()).then(e=>{var t,a;d((null==e||null==(a=e.data)||null==(t=a.filter(e=>"pending"===e.status))?void 0:t.length)||0)}).catch(e=>console.error("Error fetching pending count:",e))};return(0,r.useEffect)(()=>{u();let e=()=>u();return window.addEventListener("updatePending",e),()=>window.removeEventListener("updatePending",e)},[]),(0,n.jsxs)("aside",{className:"\n        fixed top-0 right-0 w-64 bg-gray-800 text-white shadow-lg z-40 h-screen p-4 overflow-y-auto\n        transform transition-transform duration-300 ease-in-out\n        ".concat(a?"translate-x-0":"translate-x-full md:translate-x-0","\n      "),children:[(0,n.jsx)("button",{onClick:l,className:"md:hidden absolute top-4 left-4 text-white bg-red-600 px-2 py-1 rounded",children:"إغلاق"}),(0,n.jsx)("h2",{className:"text-2xl font-bold mb-8 text-right",children:"القائمة"}),(0,n.jsxs)("nav",{className:"flex flex-col gap-2 text-right",children:["admin"===i&&(0,n.jsx)("button",{onClick:()=>t("employees"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"الموظفين"}),(0,n.jsx)("button",{onClick:()=>t("users"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"المستخدمين"}),(0,n.jsx)("button",{onClick:()=>t("locations"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"المواقع السياحية"}),(0,n.jsx)("button",{onClick:()=>t("groups"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"الرحلات الجماعية"}),(0,n.jsx)("button",{onClick:()=>t("governorates"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"المحافظات"}),(0,n.jsx)("button",{onClick:()=>t("activities"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"النشاطات"}),(0,n.jsx)("button",{onClick:()=>t("challenges"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"التحديات"}),(0,n.jsx)("button",{onClick:()=>t("suggestions"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"الاقتراحات"}),(0,n.jsx)("button",{onClick:()=>t("restaurants"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"المطاعم"}),(0,n.jsx)("button",{onClick:()=>t("hotels"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"الفنادق"}),(0,n.jsxs)("button",{onClick:()=>t("reservations"),className:"relative hover:bg-gray-700 p-2 rounded text-right flex justify-between items-center",children:[c>0&&(0,n.jsx)("span",{className:"bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full text-left ",children:c})," الحجوزات"]}),(0,n.jsx)("button",{onClick:()=>t("statistics"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"الإحصاءات"}),(0,n.jsx)("button",{onClick:()=>t("account"),className:"hover:bg-gray-700 p-2 rounded text-right",children:"معلومات الحساب"}),(0,n.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"},className:"hover:bg-gray-700 p-2 rounded text-right",children:"تسجيل الخروج"})]})]})}},1727:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>P});var n=a(7876),r=a(4232),s=a(4e3),l=a(689),i=a(3679),o=a(2491),c=a.n(o),d=a(1040),u=a(2226);function m(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("token");if(!e)return void c().fire("خطأ","الرجاء تسجيل الدخول أولاً.","error");d.A.get("".concat(u.A,"/api/getAllUser"),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{var a,n;let r=null==(n=e.data.users)||null==(a=n.original)?void 0:a.data;if(!Array.isArray(r)){console.error("rawUsers ليست مصفوفة:",r),c().fire("خطأ","بيانات المستخدمين غير صحيحة","error");return}t(r.map(e=>({id:e.id,name:e.FirstName,email:e.Email,isBanned:1===e.Block,phone:e.Number,address:e.Address,nationalId:e.Nationalnumber,pointNumber:0,idImageUrl:e.photo_url||"https://via.placeholder.com/150",isWinner:!0===e.is_winner})))}).catch(e=>{console.error("فشل في تحميل المستخدمين:",e),c().fire("خطأ","فشل في تحميل المستخدمين من الخادم","error")})},[]);let l=async(e,a)=>{let n=localStorage.getItem("token");if(!n)return void c().fire("خطأ","الرجاء تسجيل الدخول أولاً.","error");if((await c().fire({title:a?"تأكيد فك الحظر":"تأكيد الحظر",text:a?"هل أنت متأكد أنك تريد فك الحظر عن هذا المستخدم؟":"هل أنت متأكد أنك تريد حظر هذا المستخدم؟",icon:"warning",showCancelButton:!0,confirmButtonColor:a?"#3085d6":"#d33",cancelButtonColor:"#aaa",confirmButtonText:a?"نعم، فك الحظر":"نعم، احظره",cancelButtonText:"إلغاء"})).isConfirmed)try{await d.A.post("".concat(u.A,"/api/").concat(a?"unblock":"block","User/").concat(e),{},{headers:{Authorization:"Bearer ".concat(n)}}),t(t=>t.map(t=>t.id===e?{...t,isBanned:!t.isBanned}:t)),c().fire({title:a?"!تم فك الحظر":"!تم الحظر",text:a?".تم فك الحظر عن المستخدم بنجاح":".تم حظر المستخدم بنجاح",icon:"success",timer:2e3,showConfirmButton:!1,position:"center",width:"400px",padding:"1.5rem"})}catch(e){console.error("فشل في تنفيذ العملية:",e),c().fire("خطأ","حدث خطأ أثناء تنفيذ العملية","error")}},i=e=>{s(t=>t===e?null:e)};return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto bg-gray-50 shadow md:p-8 ",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-6 text-right",children:"قائمة المستخدمين"}),(0,n.jsx)("ul",{className:"flex flex-col gap-4 text-right",children:e.map(e=>(0,n.jsx)("li",{className:"flex flex-col items-end",children:(0,n.jsxs)("div",{className:"w-full bg-gray-100 p-4 rounded hover:bg-gray-200 flex flex-col gap-2",children:[(0,n.jsxs)("div",{className:"flex flex-row-reverse justify-between items-center cursor-pointer",onClick:()=>i(e.id),children:[(0,n.jsx)("button",{className:"text-lg ".concat(e.isBanned?"text-gray-400":"text-black"," hover:underline font-semibold"),children:(0,n.jsxs)("span",{className:"flex items-center gap-2",children:[e.isWinner&&(0,n.jsx)("span",{title:"فائز بتحدي",className:"text-yellow-500 text-xl",children:"\uD83C\uDFC6"}),e.name]})}),(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),l(e.id,e.isBanned)},className:"py-1 px-4 rounded ".concat(e.isBanned?"bg-green-500 hover:bg-green-700 text-white":"bg-red-500 hover:bg-red-700 text-white"),children:e.isBanned?"إلغاء الحظر":"حظر"})]}),a===e.id&&(0,n.jsxs)("div",{className:"bg-gray-100 rounded-lg shadow-md p-4 text-right w-full animate-fade-in space-y-2",children:[(0,n.jsxs)("p",{children:[e.email," ",(0,n.jsx)("strong",{children:":البريد الإلكتروني"})]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"رقم الهاتف:"})," ",e.phone]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"العنوان:"})," ",e.address]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"الرقم الوطني:"})," ",e.nationalId]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"عدد النقاط :"})," ",e.pointNumber]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-semibold",children:":صورة الهوية"}),(0,n.jsx)("img",{src:e.idImageUrl,alt:"صورة الهوية",className:"w-40 h-auto mt-1 rounded border shadow"})]})]})]})},e.id))})]})}function p(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(null),[l,o]=(0,r.useState)(null),[m,p]=(0,r.useState)([]),g=localStorage.getItem("token");(0,r.useEffect)(()=>{(async()=>{try{let e=await d.A.get("".concat(u.A,"/api/showAllEmployee"),{headers:{Authorization:"Bearer ".concat(g),Accept:"application/json"}});t(e.data.data)}catch(e){console.error("فشل في جلب الموظفين:",e),c().fire("خطأ","حدث خطأ أثناء جلب الموظفين","error")}})()},[]);let h=async()=>{let{value:e}=await c().fire({title:"إضافة موظف جديد",html:'<input id="name" class="swal2-input" placeholder="الاسم"><input id="email" class="swal2-input" placeholder="البريد الإلكتروني"><input id="password" class="swal2-input" placeholder="كلمة السر">',focusConfirm:!1,showCancelButton:!0,confirmButtonText:"إضافة",preConfirm:()=>{let e=document.getElementById("name").value,t=document.getElementById("email").value,a=document.getElementById("password").value;return e&&t&&a?{name:e,email:t,password:a}:void c().showValidationMessage("الرجاء ملء جميع الحقول")}});if(e)try{let a=await d.A.post("".concat(u.A,"/api/addEmployee"),e,{headers:{Authorization:"Bearer ".concat(g),Accept:"application/json"}});t(e=>[...e,a.data.data]),c().fire("تم","تمت إضافة الموظف بنجاح","success")}catch(e){console.error("فشل في إضافة الموظف:",e),c().fire("خطأ","حدث خطأ أثناء إضافة الموظف","error")}},x=async e=>{if((await c().fire({title:"تأكيد الحذف",text:"هل تريد بالتأكيد حذف هذا الموظف؟",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذفه",cancelButtonText:"إلغاء"})).isConfirmed)try{await d.A.delete("".concat(u.A,"/api/deleteEmployee/").concat(e),{headers:{Authorization:"Bearer ".concat(g),Accept:"application/json"}}),t(t=>t.filter(t=>t.id!==e)),c().fire("تم الحذف!","تم حذف الموظف.","success")}catch(e){console.error("فشل في حذف الموظف:",e),c().fire("خطأ","حدث خطأ أثناء حذف الموظف","error")}},f=async e=>{let{value:a}=await c().fire({title:"تعديل بيانات الموظف",html:'<input id="name" class="swal2-input" value="'.concat(e.name,'" placeholder="الاسم">')+'<input id="email" class="swal2-input" value="'.concat(e.email,'" placeholder="البريد الإلكتروني">')+'<input id="password" class="swal2-input" placeholder="كلمة السر الجديدة (اختياري)">',focusConfirm:!1,showCancelButton:!0,confirmButtonText:"حفظ",preConfirm:()=>{let e=document.getElementById("name").value,t=document.getElementById("email").value,a=document.getElementById("password").value;return e&&t?{name:e,email:t,password:a}:void c().showValidationMessage("الرجاء ملء الاسم والبريد الإلكتروني")}});if(a){let n={name:a.name,email:a.email};a.password&&(n.password=a.password);try{await d.A.put("".concat(u.A,"/api/updateEmployee/").concat(e.id),n,{headers:{Authorization:"Bearer ".concat(g),Accept:"application/json"}}),t(t=>t.map(t=>t.id===e.id?{...t,...n}:t)),c().fire("تم","تم تعديل بيانات الموظف بنجاح","success")}catch(e){console.error("فشل في تعديل الموظف:",e),c().fire("خطأ","حدث خطأ أثناء تعديل الموظف","error")}}};return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto bg-gray-50 shadow md:p-8",dir:"rtl",children:[(0,n.jsxs)("div",{className:"relative mb-6",children:[(0,n.jsxs)("button",{onClick:h,className:"absolute top-0 left-0 flex items-center gap-2 bg-blue-600 hover:bg-blue-800 text-white py-2 px-4 rounded",children:[(0,n.jsx)(i.NPy,{}),"إضافة موظف"]}),(0,n.jsx)("h1",{className:"text-3xl font-bold text-right",children:"قائمة الموظفين"})]}),(0,n.jsx)("div",{className:"flex flex-col gap-6 max-w-4xl mx-auto",children:e.map(e=>(0,n.jsx)("div",{className:"bg-gray-100 p-4 rounded-lg flex flex-col gap-3 shadow-md",children:(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center cursor-pointer",children:[(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-2",children:e.name}),(0,n.jsx)("p",{className:"text-sm",children:e.email})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>f(e),className:"bg-yellow-500 hover:bg-yellow-700 text-white p-2 rounded",children:(0,n.jsx)(i.uO9,{})}),(0,n.jsx)("button",{onClick:()=>x(e.id),className:"bg-red-600 hover:bg-red-800 text-white p-2 rounded",children:(0,n.jsx)(i.qbC,{})})]})]})},e.id))})]})}function g(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)([]),[l,o]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token");if(!e)return void c().fire("خطأ","يجب تسجيل الدخول أولا","error");let a={headers:{Authorization:"Bearer ".concat(e)}},[n,r,l]=await Promise.all([d.A.get("".concat(u.A,"/api/getAllTouristSitesWithDetails"),a),d.A.get("".concat(u.A,"/api/showAllGovernorates"),a),d.A.get("".concat(u.A,"/api/getActivity"),a)]);s(r.data.data),o(l.data.data);let i=n.data.data.map(e=>{var t,a,n;return{id:e.id,name:e.name,description:e.description,coverImageUrl:null!=(a=e.image_url)?a:"",imageUrls:Array.isArray(e.gallery_urls)?e.gallery_urls:[],governorateId:null!=(n=null==(t=e.governorate)?void 0:t.id)?n:0,governorateName:e.governorate,activities:Array.isArray(e.activities)?e.activities.map(e=>({id:e.id,name:e.name})):[]}});t(i)}catch(e){console.error("فشل في تحميل البيانات:",e),c().fire("خطأ","فشل في تحميل البيانات، تحقق من تسجيل الدخول","error")}})()},[]);let m=(e,t)=>{let n=[],r=null,s=t?t.activities.map(e=>e.id):[],i=[];c().fire({title:"add"===e?"إضافة موقع جديد":"تعديل الموقع",html:'\n        <div style="display:flex;flex-direction:column;gap:10px;direction:rtl;text-align:right">\n          <select id="location-governorate" class="swal2-select">\n            <option value="" disabled '.concat(t?"":"selected"," hidden>اختر المحافظة</option>\n            ").concat(a.map(e=>'<option value="'.concat(e.id,'" ').concat(t&&t.governorateId===e.id?"selected":"",">").concat(e.name,"</option>")).join(""),'\n          </select>\n          <input id="location-name" class="swal2-input" placeholder="اسم الموقع" value="').concat((null==t?void 0:t.name)||"",'">\n          <textarea id="location-description" class="swal2-textarea" placeholder="تفاصيل الموقع">').concat((null==t?void 0:t.description)||"",'</textarea>\n          <label>الصورة الرئيسية:</label>\n          <input type="file" id="cover-image" class="swal2-file">\n          <label>صور إضافية:</label>\n          <input type="file" id="location-images" class="swal2-file" multiple>\n          <div style="text-align:center;">\n            <button type="button" id="activity-button" class="swal2-confirm swal2-styled" style="background:#3085d6; width:150px;">\n              النشاطات\n            </button>\n          </div>\n          <div id="activity-container" style="display:none;overflow:hidden;max-height:200px;opacity:1;margin-top:10px;border:1px solid #ccc;border-radius:8px;padding:10px;transition:0.3s;">\n            ').concat(l.map(e=>'<label><input type="checkbox" value="'.concat(e.id,'" ').concat(s.includes(e.id)?"checked":"","> ").concat(e.name,"</label><br/>")).join(""),"\n          </div>\n        </div>\n      "),didOpen:()=>{var e,t,a;null==(e=document.getElementById("activity-button"))||e.addEventListener("click",()=>{let e=document.getElementById("activity-container");e&&(e.style.display="block"===e.style.display?"none":"block")}),document.querySelectorAll("#activity-container input[type='checkbox']").forEach(e=>{e.addEventListener("change",()=>{let t=+e.value;e.checked?(s.includes(t)||s.push(t),i=i.filter(e=>e!==t)):(s=s.filter(e=>e!==t),i.includes(t)||i.push(t))})}),null==(t=document.getElementById("cover-image"))||t.addEventListener("change",e=>{var t;r=(null==(t=e.target.files)?void 0:t[0])||null}),null==(a=document.getElementById("location-images"))||a.addEventListener("change",e=>{n=Array.from(e.target.files||[])})},preConfirm:()=>{let e=document.getElementById("location-name").value.trim(),t=document.getElementById("location-description").value.trim(),a=parseInt(document.getElementById("location-governorate").value);return!e||!t||isNaN(a)?void c().showValidationMessage("يرجى تعبئة كل الحقول الأساسية"):{name:e,description:t,governorateId:a,addActivities:s,removeActivities:i}},confirmButtonText:"add"===e?"إضافة":"حفظ",cancelButtonText:"إلغاء",showCancelButton:!0}).then(a=>{if(a.isConfirmed&&a.value){let s=new FormData;s.append("name",a.value.name),s.append("description",a.value.description),s.append("governorate_id",a.value.governorateId.toString()),"add"===e?a.value.addActivities.forEach(e=>s.append("activities[]",e.toString())):(a.value.addActivities.forEach(e=>s.append("add_activities[]",e.toString())),a.value.removeActivities.forEach(e=>s.append("remove_activities[]",e.toString()))),r&&s.append("image",r),n.length>0&&n.forEach(e=>{s.append("gallery[]",e)});let l="add"===e?"".concat(u.A,"/api/storeSite"):"".concat(u.A,"/api/updateSite/").concat(t.id);d.A.post(l,s,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(()=>{c().fire("تم!","add"===e?"أضيف الموقع":"تم التحديث","success"),window.location.reload()}).catch(e=>{var t,a,n;console.error("فشل في العملية:",(null==(t=e.response)?void 0:t.data)||e),c().fire("خطأ",(null==(n=e.response)||null==(a=n.data)?void 0:a.message)||"فشل في العملية","error")})}})},p=e=>c().fire({title:"تأكيد الحذف",text:"هل أنت متأكد؟",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم",cancelButtonText:"إلغاء"}).then(a=>{a.isConfirmed&&d.A.delete("".concat(u.A,"/api/deleteTouristSite/").concat(e),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(()=>{t(t=>t.filter(t=>t.id!==e)),c().fire("تم الحذف","","success")}).catch(e=>{console.error("فشل في الحذف:",e),c().fire("خطأ","فشل في الحذف","error")})}),g=async(a,n)=>{let r=localStorage.getItem("token");if(!r)return void c().fire("خطأ","يرجى تسجيل الدخول أولاً","error");let s=e.find(e=>e.id===a);if(!s||s.imageUrls.length<=1)return void c().fire("تنبيه","لا يمكن حذف الصورة. يجب أن تبقى صورة واحدة على الأقل.","warning");if(!(await c().fire({title:"هل أنت متأكد؟",text:"سيتم حذف الصورة نهائيًا!",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذفها",cancelButtonText:"إلغاء"})).isConfirmed)return;let l=n.replace("".concat(u.A,"/storage/"),"");try{await d.A.delete("".concat(u.A,"/api/deleteGalleryImageTouristSite/").concat(a),{headers:{Authorization:"Bearer ".concat(r),Accept:"application/json"},data:{image_path:l}}),t(e=>e.map(e=>e.id===a?{...e,imageUrls:e.imageUrls.filter(e=>e!==n)}:e)),c().fire("تم الحذف!","تم حذف الصورة بنجاح","success")}catch(e){console.error("فشل في حذف الصورة:",e),c().fire("خطأ","فشل في حذف الصورة من الخادم","error")}};return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto bg-gray-50 p-8",dir:"rtl",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"قائمة المواقع السياحية"}),(0,n.jsxs)("button",{onClick:()=>m("add"),className:"flex items-center gap-2 bg-green-600 hover:bg-green-800 text-white py-2 px-4 rounded",children:[(0,n.jsx)(i.OiG,{})," إضافة موقع"]})]}),(0,n.jsx)("div",{className:"flex flex-col gap-8",children:[...new Set(e.map(e=>e.governorateName))].map(t=>(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"flex flex-col gap-6",children:e.map(e=>(0,n.jsxs)("div",{className:"bg-gray-100 rounded shadow p-4",children:[(0,n.jsx)("img",{src:e.coverImageUrl,alt:"".concat(t,"-cover"),width:400,height:200,className:"w-48 h-32 object-cover rounded mb-2"}),(0,n.jsx)("div",{className:"flex gap-2 overflow-x-auto max-w-full mb-2",children:e.imageUrls.map((t,a)=>(0,n.jsxs)("div",{className:"relative group flex-shrink-0 w-48 h-32",children:[(0,n.jsx)("img",{src:t,alt:"img-".concat(a),className:"rounded object-cover w-full h-full"}),(0,n.jsx)("button",{onClick:()=>g(e.id,t),className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:(0,n.jsx)(i.qbC,{})})]},a))}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[(0,n.jsx)(i.vq8,{className:"text-blue-600"}),e.governorateName]}),(0,n.jsx)("h3",{className:"text-xl font-semibold mb-1",children:e.name}),(0,n.jsx)("p",{className:"text-gray-600 mb-1",children:e.description}),(0,n.jsxs)("p",{className:"text-black-700 text-sm mt-1",children:["النشاطات: ",e.activities.map(e=>e.name).join(", ")]}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,n.jsx)("button",{onClick:()=>m("edit",e),className:"bg-yellow-500 hover:bg-yellow-700 text-white p-2 rounded",children:(0,n.jsx)(i.uO9,{})}),(0,n.jsx)("button",{onClick:()=>p(e.id),className:"bg-red-600 hover:bg-red-800 text-white p-2 rounded",children:(0,n.jsx)(i.qbC,{})})]})]},e.id))})},t))})]})}function h(){let[e,t]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{try{let e=(await d.A.get("".concat(u.A,"/api/showAllGovernorates"))).data.data.map(e=>({id:e.id,name:e.name,description:e.description,coverImage:e.image_url||void 0,imageUrls:e.gallery_urls||[]}));t(e)}catch(e){console.error("حدث خطأ أثناء جلب المحافظات:",e),c().fire("خطأ","فشل في تحميل المحافظات","error")}})()},[]);let a=e=>{c().fire({title:"تعديل المحافظة",html:'\n        <input id="governorate-name" class="swal2-input" value="'.concat(e.name,'" placeholder="اسم المحافظة">\n        <textarea id="governorate-description" class="swal2-textarea" placeholder="تفاصيل المحافظة">').concat(e.description,'</textarea>\n        <div style="text-align: right; margin: 10px 0;">\n          <label style="font-weight: bold;">تغيير صورة الغلاف:</label><br>\n          <input type="file" id="governorate-cover-image" accept="image/*" class="swal2-file">\n        </div>\n        <div style="text-align: right; margin: 10px 0;">\n          <label style="font-weight: bold;">إضافة صور جديدة:</label><br>\n          <input type="file" id="governorate-images" multiple accept="image/*" class="swal2-file">\n        </div>\n      '),confirmButtonText:"حفظ",showCancelButton:!0,cancelButtonText:"إلغاء",preConfirm:async()=>{var e;let t=document.getElementById("governorate-name").value,a=document.getElementById("governorate-description").value,n=null==(e=document.getElementById("governorate-cover-image").files)?void 0:e[0],r=document.getElementById("governorate-images").files;return t&&a?{name:t,description:a,coverFile:n,files:r}:void c().showValidationMessage("يرجى تعبئة الاسم والتفاصيل")}}).then(async a=>{if(!a.isConfirmed||!a.value)return;let n=localStorage.getItem("token");if(!n)return void c().fire("خطأ","يرجى تسجيل الدخول أولاً","error");let{name:r,description:s,coverFile:l,files:i}=a.value,o=new FormData;o.append("name",r),o.append("description",s),l&&o.append("image",l),i&&i.length>0&&Array.from(i).forEach(e=>{o.append("gallery[]",e)});try{let a=(await d.A.post("".concat(u.A,"/api/updateGovernorate/").concat(e.id),o,{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"multipart/form-data"}})).data.data,r={id:a.id,name:a.name,description:a.description,coverImage:"".concat(u.A,"/storage/").concat(a.image),imageUrls:a.gallery.map(e=>"".concat(u.A,"/storage/").concat(e))};t(t=>t.map(t=>t.id===e.id?r:t)),c().fire("تم التحديث","تم تعديل المحافظة بنجاح","success")}catch(e){var m,p;console.error("فشل التعديل:",e),c().fire("خطأ",(null==(p=e.response)||null==(m=p.data)?void 0:m.message)||"فشل في تعديل المحافظة","error")}})},s=async e=>{let a=localStorage.getItem("token");if(!a)return void c().fire("خطأ","يرجى تسجيل الدخول أولاً","error");if((await c().fire({title:"هل أنت متأكد؟",text:"لن تتمكن من استعادة هذه المحافظة!",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذفها",cancelButtonText:"إلغاء"})).isConfirmed)try{await d.A.delete("".concat(u.A,"/api/deleteGovernorate/").concat(e),{headers:{Authorization:"Bearer ".concat(a),Accept:"application/json"}}),t(t=>t.filter(t=>t.id!==e)),c().fire("تم الحذف!","تم حذف المحافظة بنجاح","success")}catch(e){console.error("خطأ أثناء الحذف:",e),c().fire("خطأ","فشل في حذف المحافظة","error")}},l=async(a,n)=>{let r=localStorage.getItem("token");if(!r)return void c().fire("خطأ","يرجى تسجيل الدخول أولاً","error");let s=e.find(e=>e.id===a);if(!s)return void c().fire("خطأ","تعذر العثور على المحافظة","error");if(s.imageUrls.length<=1)return void c().fire("تنبيه","لا يمكن حذف الصورة. يجب أن تبقى صورة واحدة على الأقل.","warning");if(!(await c().fire({title:"هل أنت متأكد؟",text:"سيتم حذف الصورة نهائيًا!",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذفها",cancelButtonText:"إلغاء"})).isConfirmed)return;let l=n.replace("".concat(u.A,"/storage/"),"");try{await d.A.delete("".concat(u.A,"/api/deleteGalleryImage/").concat(a),{headers:{Authorization:"Bearer ".concat(r),Accept:"application/json"},data:{image_path:l}}),t(e=>e.map(e=>e.id===a?{...e,imageUrls:e.imageUrls.filter(e=>e!==n)}:e)),c().fire("تم الحذف!","تم حذف الصورة بنجاح","success")}catch(e){console.error("فشل في حذف الصورة:",e),c().fire("خطأ","فشل في حذف الصورة من الخادم","error")}};return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto bg-gray-50 shadow md:p-8",dir:"rtl",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"قائمة المحافظات"}),(0,n.jsxs)("button",{onClick:()=>{c().fire({title:"إضافة محافظة",html:'\n        <input id="governorate-name" class="swal2-input" placeholder="اسم المحافظة">\n        <textarea id="governorate-description" class="swal2-textarea" placeholder="تفاصيل المحافظة"></textarea>\n        <div style="text-align: right; margin: 10px 0;">\n          <label style="font-weight: bold;">صورة الغلاف:</label><br>\n          <input type="file" id="governorate-cover-image" accept="image/*" class="swal2-file">\n        </div>\n        <div style="text-align: right; margin: 10px 0;">\n          <label style="font-weight: bold;">صور إضافية:</label><br>\n          <input type="file" id="governorate-images" multiple accept="image/*" class="swal2-file">\n        </div>\n      ',confirmButtonText:"إضافة",showCancelButton:!0,cancelButtonText:"إلغاء",preConfirm:()=>{var e;let t=document.getElementById("governorate-name").value,a=document.getElementById("governorate-description").value,n=null==(e=document.getElementById("governorate-cover-image").files)?void 0:e[0],r=document.getElementById("governorate-images").files;return t&&a&&n&&r&&0!==r.length?{name:t,description:a,coverFile:n,files:r}:void c().showValidationMessage("يرجى تعبئة جميع الحقول وتحميل صورة غلاف وصورة/صور")}}).then(async e=>{if(e.isConfirmed&&e.value){let r=localStorage.getItem("token");if(!r)return void c().fire("خطأ","يرجى تسجيل الدخول أولاً","error");let{name:s,description:l,coverFile:i,files:o}=e.value,m=new FormData;m.append("name",s),m.append("description",l),m.append("image",i),Array.from(o).forEach(e=>{m.append("gallery[]",e)});try{let e=(await d.A.post("".concat(u.A,"/api/storeGovernorate"),m,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(r)}})).data.data,a={id:e.id,name:e.name,description:e.description,coverImage:"".concat(u.A,"/storage/").concat(e.image),imageUrls:e.gallery.map(e=>"".concat(u.A,"/storage/").concat(e))};t(e=>[...e,a]),c().fire("!تمت الإضافة",".تمت إضافة المحافظة بنجاح","success")}catch(e){var a,n;c().fire("خطأ",(null==(n=e.response)||null==(a=n.data)?void 0:a.message)||"فشل في إرسال البيانات","error")}}})},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-800 text-white py-2 px-4 rounded",children:[(0,n.jsx)(i.OiG,{}),"إضافة محافظة"]})]}),(0,n.jsx)("div",{className:"flex flex-col gap-8",children:e.map(e=>(0,n.jsxs)("div",{className:"bg-white rounded shadow p-4",children:[e.coverImage&&(0,n.jsx)("img",{src:e.coverImage,alt:"".concat(e.name,"-cover"),className:"w-48 h-32 object-cover rounded mb-2"}),e.imageUrls.length>0&&(0,n.jsx)("div",{className:"flex gap-2 overflow-x-auto max-w-full mb-2",children:e.imageUrls.map((t,a)=>(0,n.jsxs)("div",{className:"relative group flex-shrink-0 w-48 h-32",children:[(0,n.jsx)("img",{src:t,alt:"".concat(e.name,"-").concat(a),className:"w-full h-full object-cover rounded"}),(0,n.jsx)("button",{onClick:()=>l(e.id,t),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full",children:(0,n.jsx)(i.qbC,{})})]},a))}),(0,n.jsx)("h2",{className:"text-xl font-bold mt-2",children:e.name}),(0,n.jsx)("p",{className:"text-gray-700",children:e.description}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,n.jsx)("button",{onClick:()=>a(e),className:"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded",children:(0,n.jsx)(i.uO9,{})}),(0,n.jsx)("button",{onClick:()=>s(e.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded",children:(0,n.jsx)(i.qbC,{})})]})]},e.id))})]})}function x(e){return new Date(e).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}function f(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)([]),l=localStorage.getItem("token");(0,r.useEffect)(()=>{d.A.get("".concat(u.A,"/api/getAllTouristSitesWithDetails")).then(e=>s(e.data.data||e.data)).catch(()=>c().fire("خطأ","فشل في جلب المواقع السياحية","error"))},[]),(0,r.useEffect)(()=>{d.A.get("".concat(u.A,"/api/getAllGroupTrips")).then(async e=>{let n=e.data.data||e.data;t(await Promise.all(n.map(async e=>{let t=[];try{t=(await d.A.post("".concat(u.A,"/api/getAttachment"),{group_trip_id:e.id},{headers:{Authorization:"Bearer ".concat(l)}})).data.data.map(e=>({name:e.name,price:Number(e.price),id:e.id}))}catch(e){t=[]}let n=a.find(t=>t.id===e.tourist_site_id);return{id:e.id,destination:e.Destination_name,siteId:null==n?void 0:n.id,siteName:null==n?void 0:n.name,startTime:e.start_time,endTime:e.end_time,details:e.Details,personCount:Number(e.number_of_people),costPerPerson:Number(e.cost),discountPercentage:e.discount_percentage?Number(e.discount_percentage):null,mainImageUrl:"".concat(u.A,"/storage/")+e.image,imageUrls:(e.gallery||[]).map(e=>"".concat(u.A,"/storage/")+e),attachments:t}})))}).catch(()=>{c().fire("خطأ","فشل في جلب الرحلات","error")})},[l]);let o=e=>{c().fire({title:"إضافة مرفق",html:'\n        <input id="new-attachment-name" class="swal2-input" placeholder="اسم المرفق">\n        <input id="new-attachment-price" class="swal2-input" type="number" placeholder="سعر المرفق">\n      ',showCancelButton:!0,confirmButtonText:"إضافة",cancelButtonText:"إلغاء",preConfirm:()=>{let e=document.getElementById("new-attachment-name").value,t=document.getElementById("new-attachment-price").value,a=Number(t);return e&&t?{name:e,price:a}:void c().showValidationMessage("الرجاء تعبئة كل الحقول")}}).then(async a=>{if(a.isConfirmed&&a.value)try{let n=(await d.A.post("".concat(u.A,"/api/addAttachment"),{name:a.value.name,price:a.value.price,group_trip_id:e},{headers:{Authorization:"Bearer ".concat(l)}})).data.data;console.log(n),t(t=>t.map(t=>t.id===e?{...t,attachments:[...t.attachments||[],{name:n.name,price:Number(n.price),id:n.id}]}:t)),c().fire("تمت إضافة المرفق","","success")}catch(e){c().fire("خطأ","فشل في إضافة المرفق","error")}})},m=async(a,n)=>{let r=localStorage.getItem("token");if(!r)return void c().fire("خطأ","يرجى تسجيل الدخول أولاً","error");let s=e.find(e=>e.id===a);if(!s)return void c().fire("خطأ","تعذر العثور على الرحلة","error");if(s.imageUrls.length<=1)return void c().fire("تنبيه","لا يمكن حذف الصورة. يجب أن تبقى صورة واحدة على الأقل.","warning");if(!(await c().fire({title:"هل أنت متأكد؟",text:"سيتم حذف الصورة نهائيًا!",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذفها",cancelButtonText:"إلغاء"})).isConfirmed)return;let l=n.replace("".concat(u.A,"/storage/"),"");try{await d.A.delete("".concat(u.A,"/api/deleteGalleryImageGroupTrip/").concat(a),{headers:{Authorization:"Bearer ".concat(r),Accept:"application/json"},data:{image_path:l}}),t(e=>e.map(e=>e.id===a?{...e,imageUrls:e.imageUrls.filter(e=>e!==n)}:e)),c().fire("تم الحذف!","تم حذف الصورة بنجاح","success")}catch(e){console.error("فشل في حذف الصورة:",e),c().fire("خطأ","فشل في حذف الصورة من الخادم","error")}},p=(a,n)=>{let r=e.find(e=>e.id===a);if(!r||!r.attachments)return;let s=r.attachments[n];c().fire({title:"هل أنت متأكد من حذف المرفق؟",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذف",cancelButtonText:"إلغاء"}).then(async e=>{if(e.isConfirmed)try{await d.A.delete("".concat(u.A,"/api/deleteAttachment/").concat(s.id),{headers:{Authorization:"Bearer ".concat(l)}}),t(e=>e.map(e=>{var t;return e.id===a?{...e,attachments:null==(t=e.attachments)?void 0:t.filter((e,t)=>t!==n)}:e})),c().fire("تم الحذف","تم حذف المرفق بنجاح","success")}catch(e){c().fire("خطأ","فشل في حذف المرفق","error")}})},g=(e,a,n)=>{c().fire({title:"تعديل المرفق",html:'\n        <input id="edit-name" class="swal2-input" value="'.concat(n.name,'">\n        <input id="edit-price" class="swal2-input" type="number" value="').concat(n.price,'">\n      '),preConfirm:()=>{let e=document.getElementById("edit-name").value,t=Number(document.getElementById("edit-price").value);return e&&t?{name:e,price:t}:void c().showValidationMessage("جميع الحقول مطلوبة")},showCancelButton:!0,confirmButtonText:"حفظ"}).then(async r=>{if(r.isConfirmed&&r.value)try{await d.A.put("".concat(u.A,"/api/updateAttachment/").concat(n.id),{name:r.value.name,price:r.value.price},{headers:{Authorization:"Bearer ".concat(l)}}),t(t=>t.map(t=>{var n;return t.id===e?{...t,attachments:null==(n=t.attachments)?void 0:n.map((e,t)=>t===a?{...e,name:r.value.name,price:r.value.price}:e)}:t})),c().fire("تم التعديل","","success")}catch(e){c().fire("خطأ","فشل في تعديل المرفق","error")}})},h=e=>{var n;c().fire({title:"تعديل الرحلة",html:'\n    <select id="edit-site" class="swal2-select">\n        <option value="" disabled hidden>اختر الموقع السياحي</option>\n        '.concat(a.map(t=>'<option value="'.concat(t.id,'" ').concat(e.siteId===t.id?"selected":"",">").concat(t.name,"</option>")).join(""),'\n      </select>\n      <input id="trip-destination" class="swal2-input" value="').concat(e.destination,'" placeholder="الوجهة">\n      <input id="trip-start" class="swal2-input" type="datetime-local" value="').concat(e.startTime,'">\n      <input id="trip-end" class="swal2-input" type="datetime-local" value="').concat(e.endTime,'">\n      <textarea id="trip-details" class="swal2-textarea" placeholder="تفاصيل">').concat(e.details,'</textarea>\n      <input id="trip-count" class="swal2-input" type="number" value="').concat(e.personCount,'" placeholder="عدد الأشخاص">\n      <input id="trip-cost" class="swal2-input" type="number" value="').concat(e.costPerPerson,'" placeholder="الكلفة للشخص">\n<input id="trip-discount" class="swal2-input" type="number" min="0" max="100" placeholder="نسبة العرض (%)" value="').concat(null!=(n=e.discountPercentage)?n:"",'">/////\n      <div style="text-align: right; margin: 10px 0;">\n        <label style="font-weight: bold;">\uD83D\uDCF7 تغيير الصورة الرئيسية:</label><br>\n        <input type="file" id="trip-main-image" accept="image/*" class="swal2-file">\n      </div>\n\n      <div style="text-align: right; margin: 10px 0;">\n        <label style="font-weight: bold;">\uD83D\uDDBC️ إضافة صور جديدة:</label><br>\n        <input type="file" id="trip-gallery" multiple accept="image/*" class="swal2-file">\n      </div>\n    '),confirmButtonText:"حفظ التعديلات",showCancelButton:!0,cancelButtonText:"إلغاء",preConfirm:async()=>{var e;let t=Number(document.getElementById("edit-site").value),a=document.getElementById("trip-destination").value,n=document.getElementById("trip-start").value,r=document.getElementById("trip-end").value,s=document.getElementById("trip-details").value,l=Number(document.getElementById("trip-count").value),i=Number(document.getElementById("trip-cost").value),o=null==(e=document.getElementById("trip-main-image").files)?void 0:e[0],d=document.getElementById("trip-gallery").files,u=document.getElementById("trip-discount").value,m=u?Number(u):null;return t&&a&&n&&r&&s&&!(l<=0)&&!(i<=0)?{siteId:t,destination:a,startTime:n,endTime:r,details:s,personCount:l,costPerPerson:i,discountPercentage:m,mainFile:o,galleryFiles:d}:void c().showValidationMessage("يرجى تعبئة كافة الحقول بشكل صحيح")}}).then(async n=>{if(!n.isConfirmed||!n.value)return;let r=localStorage.getItem("token");if(!r)return void c().fire("خطأ","يرجى تسجيل الدخول أولاً","error");let{siteId:s,destination:l,startTime:i,endTime:o,details:m,personCount:p,costPerPerson:g,discountPercentage:h,mainFile:x,galleryFiles:f}=n.value,b=new FormData;b.append("tourist_site_id",s.toString()),b.append("Destination_name",l),b.append("start_time",i),b.append("end_time",o),b.append("Details",m),b.append("number_of_people",p.toString()),b.append("cost",g.toString()),null!=h&&b.append("discount_percentage",h.toString()),x&&b.append("image",x),f&&f.length>0&&Array.from(f).forEach(e=>{b.append("gallery[]",e)});try{let n=(await d.A.post("".concat(u.A,"/api/updateGroupTrip/").concat(e.id),b,{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"multipart/form-data"}})).data.data;if(!s)return void c().showValidationMessage("يرجى اختيار الموقع السياحي");let l=a.find(e=>e.id===s);if(!l)return void c().showValidationMessage("الموقع السياحي غير موجود");let i={...e,siteId:s,siteName:l.name,destination:n.Destination_name,startTime:n.start_time,endTime:n.end_time,details:n.Details,personCount:n.number_of_people,costPerPerson:n.cost,discountPercentage:n.discount_percentage?Number(n.discount_percentage):null,mainImageUrl:"".concat(u.A,"/storage/").concat(n.image),imageUrls:n.gallery.map(e=>"".concat(u.A,"/storage/").concat(e))};t(t=>t.map(t=>t.id===e.id?i:t)),c().fire("تم التحديث","تم تعديل الرحلة بنجاح","success")}catch(e){var v,y;console.error("خطأ:",e),c().fire("خطأ",(null==(y=e.response)||null==(v=y.data)?void 0:v.message)||"فشل في تعديل الرحلة","error")}})},f=async e=>{try{await d.A.delete("".concat(u.A,"/api/deleteGroupTrip/").concat(e),{headers:{Authorization:"Bearer ".concat(l),Accept:"application/json"}}),t(t=>t.filter(t=>t.id!==e)),c().fire("تم الحذف","","success")}catch(e){var a,n;console.error("API Delete Error:",e.response||e.message||e),c().fire("خطأ","فشل في حذف الرحلة: "+((null==(n=e.response)||null==(a=n.data)?void 0:a.message)||e.message),"error")}};return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto bg-gray-50 shadow md:p-8",dir:"rtl",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"الرحلات الجماعية"}),(0,n.jsxs)("button",{onClick:()=>{c().fire({title:"إضافة رحلة جديدة",html:'\n        \n        <div style="display: flex; flex-direction: column; gap: 8px;">\n        <select id="add-site" class="swal2-select">\n          <option value="" disabled selected hidden>اختر الموقع السياحي</option>\n          '.concat(a.map(e=>'<option value="'.concat(e.id,'">').concat(e.name,"</option>")).join(""),'\n        </select>\n          <input id="add-destination" class="swal2-input" placeholder="الوجهة">\n          <input id="add-start" class="swal2-input" type="datetime-local">\n          <input id="add-end" class="swal2-input" type="datetime-local">\n          <textarea id="add-details" class="swal2-textarea" placeholder="تفاصيل الرحلة"></textarea>\n          <input id="add-count" class="swal2-input" type="number" placeholder="عدد الأشخاص">\n          <input id="add-cost" class="swal2-input" type="number" placeholder="الكلفة للشخص">\n <input id="add-discount" class="swal2-input" type="number" placeholder="نسبة العرض (%)" min="0" max="100">////////////\n          <label class="swal2-label">\uD83D\uDCF7 الصورة الرئيسية:</label>\n          <input id="add-main-image" class="swal2-file" type="file" accept="image/*">\n\n          <label class="swal2-label">\uD83D\uDDBC️ الصور الإضافية:</label>\n          <input id="add-images" class="swal2-file" type="file" multiple accept="image/*">\n        </div>\n      '),showCancelButton:!0,confirmButtonText:"إضافة",cancelButtonText:"إلغاء",preConfirm:()=>{var e;let t=Number(document.getElementById("add-site").value),a=document.getElementById("add-destination").value,n=document.getElementById("add-start").value,r=document.getElementById("add-end").value,s=document.getElementById("add-details").value,l=Number(document.getElementById("add-count").value),i=Number(document.getElementById("add-cost").value),o=document.getElementById("add-discount").value,d=o?Number(o):null,u=null==(e=document.getElementById("add-main-image").files)?void 0:e[0],m=Array.from(document.getElementById("add-images").files||[]);return t&&a&&n&&r&&s&&l&&i&&u?Promise.all([Promise.resolve(t),Promise.resolve(a),Promise.resolve(n),Promise.resolve(r),Promise.resolve(s),Promise.resolve(l),Promise.resolve(i),Promise.resolve(d),Promise.resolve(u),Promise.resolve(m)]):void c().showValidationMessage("يرجى تعبئة جميع الحقول الأساسية واختيار صورة رئيسية")}}).then(async e=>{if(e.isConfirmed&&e.value){let[s,i,o,m,p,g,h,x,f,b]=e.value,v=new FormData;v.append("tourist_site_id",s.toString()),v.append("Destination_name",i),v.append("start_time",o),v.append("end_time",m),v.append("Details",p),v.append("number_of_people",g.toString()),v.append("cost",h.toString()),null!=x&&v.append("discount_percentage",x.toString()),v.append("image",f),b.forEach(e=>v.append("gallery[]",e));try{let e=(await d.A.post("".concat(u.A,"/api/addGroupTrip"),v,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(l)}})).data.data;if(!s)return void c().showValidationMessage("يرجى اختيار الموقع السياحي");let n=a.find(e=>e.id===s);if(!n)return void c().showValidationMessage("الموقع السياحي غير موجود");let r={id:e.id,destination:e.Destination_name,siteId:s,siteName:n.name,startTime:e.start_time,endTime:e.end_time,details:e.Details,personCount:Number(e.number_of_people),costPerPerson:Number(e.cost),discountPercentage:e.discount_percentage?Number(e.discount_percentage):null,mainImageUrl:"".concat(u.A,"/storage/")+e.image,imageUrls:(e.gallery||[]).map(e=>"".concat(u.A,"/storage/")+e),attachments:[]};t(e=>[...e,r]),c().fire("تمت الإضافة","","success")}catch(e){var n,r;console.error("API Error:",e.response||e.message||e),c().fire("خطأ","فشل في إضافة الرحلة: "+((null==(r=e.response)||null==(n=r.data)?void 0:n.message)||e.message),"error")}}})},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-800 text-white py-2 px-4 rounded",children:[(0,n.jsx)(i.OiG,{}),"إضافة رحلة"]})]}),(0,n.jsx)("div",{className:"flex flex-col gap-6",children:e.map(e=>{var t,a,r;return(0,n.jsxs)("div",{className:"bg-gray-100 p-4 rounded shadow",children:[(0,n.jsx)("div",{className:"mb-3",children:(0,n.jsx)("img",{src:e.mainImageUrl,alt:"main",className:"w-48 h-32 object-cover rounded my-2"})}),e.imageUrls.length>0&&(0,n.jsx)("div",{className:"flex gap-2 overflow-x-auto max-w-full mb-2",children:e.imageUrls.map((t,a)=>(0,n.jsxs)("div",{className:"relative group flex-shrink-0 w-48 h-32",children:[(0,n.jsx)("img",{src:t,alt:"img-".concat(a),className:"w-full h-full object-cover rounded"}),(0,n.jsx)("button",{onClick:()=>m(e.id,t),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full",children:(0,n.jsx)(i.qbC,{})})]},a))}),e.siteName&&(0,n.jsx)("h3",{className:"text-lg font-semibold text-blue-600",children:e.siteName}),(0,n.jsx)("h2",{className:"text-xl font-bold mt-2",children:e.destination}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"من:"})," ",x(e.startTime)]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"إلى:"})," ",x(e.endTime)]}),(0,n.jsx)("p",{children:e.details}),(0,n.jsxs)("p",{children:["\uD83D\uDC65 عدد الأشخاص: ",e.personCount]}),(0,n.jsxs)("p",{children:[" الكلفة للشخص: ",e.costPerPerson," ل.س"]}),null!=e.discountPercentage&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{children:[" العرض: ",e.discountPercentage,"%"]}),(0,n.jsxs)("p",{children:[" الكلفة بعد الخصم: ",(e.costPerPerson*(1-e.discountPercentage/100)).toFixed(2)," ل.س"]})]}),(0,n.jsxs)("button",{onClick:()=>o(e.id),className:"mt-2 flex items-center gap-1 text-blue-600 font-bold hover:underline text-sm",children:[(0,n.jsx)(i.OiG,{className:"text-xs "}),"مرفق"]}),(null!=(a=null==(t=e.attachments)?void 0:t.length)?a:0)>0&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"\uD83E\uDDF3 المرفقات:"}),(null!=(r=e.attachments)?r:[]).map((t,a)=>(0,n.jsxs)("div",{className:"flex items-center justify-between bg-white p-2 my-1 rounded shadow-sm",children:[(0,n.jsxs)("span",{children:[t.name," - ",t.price," ل.س"]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>g(e.id,a,t),className:"bg-yellow-400 hover:bg-yellow-500 text-white p-1 rounded",children:(0,n.jsx)(i.uO9,{})}),(0,n.jsx)("button",{onClick:()=>p(e.id,a),className:"bg-red-500 hover:bg-red-600 text-white p-1 rounded",children:(0,n.jsx)(i.qbC,{})})]})]},a))]}),(0,n.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,n.jsxs)("button",{onClick:()=>h(e),className:"bg-yellow-500 hover:bg-yellow-600 text-white py-1 px-3 rounded flex items-center gap-1",children:[(0,n.jsx)(i.uO9,{}),"تعديل الرحلة"]}),(0,n.jsxs)("button",{onClick:()=>f(e.id),className:"bg-red-600 hover:bg-red-800 text-white py-1 px-3 rounded flex items-center gap-1",children:[(0,n.jsx)(i.qbC,{}),"حذف الرحلة"]})]})]},e.id)})})]})}function b(){let[e,t]=(0,r.useState)(""),[a,s]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token");try{let t=await d.A.get("".concat(u.A,"/api/getActivity"),{headers:{Authorization:"Bearer ".concat(e),Accept:"application/json"}});s(t.data.data)}catch(e){console.error("فشل في جلب النشاطات:",e),c().fire("خطأ","حدث خطأ أثناء جلب النشاطات","error")}})()},[]);let l=async()=>{if(""===e.trim())return void c().fire("تنبيه","يرجى إدخال اسم النشاط","warning");let a=localStorage.getItem("token");try{let n=(await d.A.post("".concat(u.A,"/api/addActivity"),{name:e},{headers:{Authorization:"Bearer ".concat(a),Accept:"application/json"}})).data.data;s(e=>[...e,n]),t(""),c().fire("تم","تمت إضافة النشاط بنجاح","success")}catch(e){console.error("فشل في إضافة النشاط:",e),c().fire("خطأ","حدث خطأ أثناء إضافة النشاط","error")}},o=async e=>{let t=localStorage.getItem("token");try{await d.A.delete("".concat(u.A,"/api/deleteActivity/").concat(e),{headers:{Authorization:"Bearer ".concat(t),Accept:"application/json"}}),s(t=>t.filter(t=>t.id!==e)),c().fire("تم","تم حذف النشاط بنجاح","success")}catch(e){console.error("فشل في حذف النشاط:",e),c().fire("خطأ","حدث خطأ أثناء حذف النشاط","error")}};return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto bg-gray-50 shadow md:p-8",dir:"rtl",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-center mb-4",children:"\uD83D\uDCDD الأنشطة"}),(0,n.jsx)("input",{type:"text",className:"p-2 border bg-white rounded mb-4 w-full",placeholder:"أدخل اسم النشاط",value:e,onChange:e=>t(e.target.value)}),(0,n.jsxs)("button",{onClick:l,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:[(0,n.jsx)(i.OiG,{}),"إضافة النشاط"]}),(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsx)("h3",{className:"text-xl font-bold mb-2",children:"النشاطات المضافة:"}),(0,n.jsx)("ul",{className:"space-y-2",children:a.length>0?a.map((e,t)=>(0,n.jsxs)("li",{className:"flex justify-between items-center bg-white p-2 rounded shadow",children:[(0,n.jsx)("span",{className:"text-lg",children:e.name}),(0,n.jsx)("button",{onClick:()=>o(e.id),className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600",children:(0,n.jsx)(i.qbC,{})})]},t)):(0,n.jsx)("li",{className:"text-lg",children:"لا توجد نشاطات مضافة بعد."})})]})]})}function v(){let[e,t]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{try{let e=(await d.A.get("".concat(u.A,"/api/getCompetition"))).data.data.map(e=>({id:e.id,title:e.name,condition:a(e.Competition_condition)}));t(e)}catch(e){console.error("فشل في تحميل التحديات:",e),c().fire("خطأ","تعذر تحميل التحديات من الخادم","error")}})()},[]);let a=e=>{switch(e){case"rate_5_sites":return"قيّم 5 مواقع سياحية";case"walk_10000_steps":return"المشي 10,000 خطوة يومياً";case"read_a_book":return"اقرأ كتاباً كاملاً";default:return e}};return(0,n.jsxs)("div",{className:"max-w-4xl mx-auto bg-gray-50 shadow md:p-8",dir:"rtl",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center",children:"\uD83C\uDFAF قائمة التحديات"}),(0,n.jsx)("div",{className:"space-y-4",children:e.length>0?e.map(e=>(0,n.jsx)("div",{className:"p-4 bg-gray-100 rounded flex justify-between items-center",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-lg",children:e.title}),(0,n.jsx)("p",{className:"text-gray-700",children:e.condition})]})},e.id)):(0,n.jsx)("p",{className:"text-center text-gray-500",children:"لا توجد تحديات حالياً"})})]})}function y(){let[e,t]=(0,r.useState)(""),[a,s]=(0,r.useState)(""),[l,o]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token");if(e)try{let a=await fetch("".concat(u.A,"/api/admininformation"),{headers:{Authorization:"Bearer ".concat(e),Accept:"application/json"}}),n=await a.json();1===n.status&&n.data?(t(n.data.name||""),s(n.data.email||"")):console.error("فشل في جلب البيانات:",n.message)}catch(e){console.error("خطأ أثناء جلب معلومات الحساب:",e)}})()},[]),(0,n.jsxs)("div",{className:"max-w-6xl mx-auto bg-gray-50 shadow md:p-8",dir:"rtl",children:[(0,n.jsx)("h2",{className:"text-3xl font-bold text-blue-700 mb-6 text-center",children:"\uD83E\uDDFE معلومات الحساب"}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("h2",{className:"font-bold mb-4",children:"الاسم"}),(0,n.jsxs)("div",{className:"flex items-center gap-2 pb-1 border-b",children:[(0,n.jsx)(i.x$1,{className:"text-gray-500"}),l?(0,n.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),className:"w-full border rounded px-4 py-2 text-right transition-all focus:outline-none focus:ring-2 focus:ring-blue-500"}):(0,n.jsx)("span",{className:"text-gray-800",children:e})]}),(0,n.jsx)("h2",{className:"font-bold mb-4",children:"البريد الالكتروني"}),(0,n.jsxs)("div",{className:"flex items-center gap-2 pb-1 border-b",children:[(0,n.jsx)(i.maD,{className:"text-gray-500"}),l?(0,n.jsx)("input",{type:"email",value:a,onChange:e=>s(e.target.value),className:"w-full border rounded px-4 py-2 text-right transition-all focus:outline-none focus:ring-2 focus:ring-blue-500"}):(0,n.jsx)("span",{className:"text-gray-800",children:a})]})]})]})}function w(){let[e,t]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=localStorage.getItem("token");if(!e)return void c().fire("خطأ","الرجاء تسجيل الدخول أولاً.","error");d.A.get("".concat(u.A,"/api/showAllSuggestion"),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{t(e.data.data.map(e=>({id:e.id,email:e.email,message:e.Suggestion})))}).catch(e=>{console.error("فشل في تحميل الاقتراحات:",e),c().fire("خطأ","فشل في تحميل الاقتراحات - ربما تحتاج تسجيل دخول","error")})},[]);let a=async e=>{if((await c().fire({title:"هل أنت متأكد من حذف هذا الاقتراح؟",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذفه",cancelButtonText:"إلغاء"})).isConfirmed)try{await d.A.delete("".concat(u.A,"/api/deleteSuggestion/").concat(e),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),t(t=>t.filter(t=>t.id!==e)),c().fire("تم الحذف!","تم حذف الاقتراح بنجاح.","success")}catch(e){console.error("فشل في حذف الاقتراح:",e),c().fire("خطأ","فشل في حذف الاقتراح","error")}},s=async()=>{if((await c().fire({title:"هل أنت متأكد من حذف جميع الاقتراحات؟",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذف الكل",cancelButtonText:"إلغاء"})).isConfirmed)try{await d.A.delete("".concat(u.A,"/api/destroyAllSuggestion"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),t([]),c().fire("تم الحذف!","تم حذف جميع الاقتراحات.","success")}catch(e){console.error("فشل في حذف جميع الاقتراحات:",e),c().fire("خطأ","فشل في حذف جميع الاقتراحات","error")}};return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto p-4 md:p-8 bg-gray-50 shadow",dir:"rtl",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-blue-800",children:"\uD83D\uDCA1 اقتراحات المستخدمين"}),e.length>0&&(0,n.jsx)("button",{onClick:s,className:"bg-gray-700 hover:bg-red-600 text-white px-4 py-2 rounded text-sm shadow",children:"حذف الكل \uD83D\uDDD1️"})]}),0===e.length?(0,n.jsx)("p",{className:"text-center text-gray-500",children:"لا توجد اقتراحات حاليًا."}):(0,n.jsx)("div",{className:"space-y-6",children:e.map(e=>(0,n.jsxs)("div",{className:"bg-white border border-gray-200 p-4 rounded-lg shadow-sm relative",children:[(0,n.jsx)("button",{onClick:()=>a(e.id),className:"absolute top-3 left-3 text-red-500 hover:text-red-700",title:"حذف الاقتراح",children:(0,n.jsx)(i.qbC,{})}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-blue-700 font-semibold mb-2",children:[(0,n.jsx)(i.maD,{}),(0,n.jsx)("span",{children:e.email})]}),(0,n.jsxs)("div",{className:"flex items-start gap-2 text-gray-800",children:[(0,n.jsx)(i.hYw,{className:"mt-1 text-gray-400"}),(0,n.jsx)("p",{children:e.message})]})]},e.id))})]})}function j(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)([]),[l,o]=(0,r.useState)({name:"",status:"",address:"",tourist_site_id:0}),[m,p]=(0,r.useState)(null),[g,h]=(0,r.useState)(!1),[x,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("token");if(!e)return void c().fire("خطأ","الرجاء تسجيل الدخول أولاً.","error");f(e),b(e),v(e)},[]);let b=async e=>{h(!0);try{let a=await d.A.get("".concat(u.A,"/api/showAllRestaurant"),{headers:{Authorization:"Bearer ".concat(e)}});t(a.data.data||[])}catch(e){c().fire("خطأ","فشل في جلب المطاعم","error")}finally{h(!1)}},v=async e=>{h(!0);try{let t=await d.A.get("".concat(u.A,"/api/getAllTouristSitesWithDetails"),{headers:{Authorization:"Bearer ".concat(e)}});s(t.data.data||[])}catch(e){c().fire("خطأ","فشل في جلب المواقع السياحية","error")}finally{h(!1)}},y=async()=>{if(l.name.trim()&&x){h(!0);try{null!==m?(await d.A.put("".concat(u.A,"/api/updateRestaurant/").concat(m),l,{headers:{Authorization:"Bearer ".concat(x)}}),c().fire("نجاح","تم تعديل المطعم بنجاح","success")):(await d.A.post("".concat(u.A,"/api/addRestaurant"),l,{headers:{Authorization:"Bearer ".concat(x)}}),c().fire("نجاح","تمت إضافة المطعم بنجاح","success")),o({name:"",status:"",address:"",tourist_site_id:0}),p(null),b(x)}catch(e){c().fire("خطأ","حدثت مشكلة أثناء الحفظ","error")}finally{h(!1)}}},w=e=>{o({name:e.name,status:e.status,address:e.address,tourist_site_id:e.tourist_site_id}),p(e.id)},j=async e=>{x&&c().fire({title:"هل أنت متأكد؟",text:"لن تتمكن من التراجع عن هذا الإجراء",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذف",cancelButtonText:"إلغاء"}).then(async t=>{if(t.isConfirmed){h(!0);try{await d.A.delete("".concat(u.A,"/api/deleteRestaurant/").concat(e),{headers:{Authorization:"Bearer ".concat(x)}}),c().fire("!تم الحذف","تم حذف المطعم بنجاح","success"),b(x)}catch(e){c().fire("خطأ","فشل في حذف المطعم","error")}finally{h(!1)}}})};return(0,n.jsxs)("div",{className:"max-w-3xl mx-auto p-4 md:p-8 bg-white shadow rounded-lg",dir:"rtl",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center text-blue-700",children:"إدارة المطاعم"}),g&&(0,n.jsxs)("div",{className:"text-center my-4",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-4 border-blue-600 mx-auto"}),(0,n.jsx)("p",{className:"text-blue-600 mt-2",children:"جارٍ التحميل..."})]}),(0,n.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,n.jsx)("input",{type:"text",name:"name",placeholder:"اسم المطعم",value:l.name,onChange:e=>o({...l,name:e.target.value}),className:"border p-2 rounded w-full max-w-md"}),(0,n.jsx)("input",{type:"text",name:"address",placeholder:"العنوان",value:l.address,onChange:e=>o({...l,address:e.target.value}),className:"border p-2 rounded w-full max-w-md"}),(0,n.jsx)("input",{type:"text",name:"status",placeholder:"الحالة",value:l.status,onChange:e=>o({...l,status:e.target.value}),className:"border p-2 rounded w-full max-w-md"}),(0,n.jsxs)("select",{name:"tourist_site_id",value:l.tourist_site_id,onChange:e=>o({...l,tourist_site_id:Number(e.target.value)}),className:"border p-2 rounded w-full max-w-md text-gray-500",children:[(0,n.jsx)("option",{value:0,disabled:!0,children:"اختر الموقع السياحي"}),a.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsx)("button",{onClick:y,disabled:g,className:"w-full md:w-auto px-6 py-2 rounded text-white font-semibold transition ".concat(null!==m?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"," flex items-center justify-center gap-2"),children:null!==m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.uO9,{})," حفظ التعديلات"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.OiG,{})," إضافة مطعم"]})}),(0,n.jsxs)("div",{className:"mt-10",children:[(0,n.jsx)("h3",{className:"text-xl font-bold mb-4",children:" قائمة المطاعم"}),0===e.length?(0,n.jsx)("p",{className:"text-gray-500",children:"لا توجد مطاعم مضافة بعد."}):(0,n.jsx)("div",{className:"space-y-4",children:e.map(e=>{let t=a.find(t=>t.id===e.tourist_site_id);return(0,n.jsxs)("div",{className:"p-4 rounded bg-gray-50 shadow-sm flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"اسم المطعم:"})," ",e.name]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"العنوان:"})," ",e.address]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"الموقع السياحي:"})," ",(null==t?void 0:t.name)||"غير محدد"]}),(0,n.jsxs)("p",{className:"text-sm font-medium text-blue-600",children:[(0,n.jsx)("strong",{children:"الحالة:"})," ",e.status]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)("button",{onClick:()=>w(e),disabled:g,className:"px-3 py-1 bg-yellow-500 hover:bg-yellow-600 text-white rounded flex items-center gap-1",children:[(0,n.jsx)(i.uO9,{})," تعديل"]}),(0,n.jsxs)("button",{onClick:()=>j(e.id),disabled:g,className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded flex items-center gap-1",children:[(0,n.jsx)(i.qbC,{})," حذف"]})]})]},e.id)})})]})]})}function N(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)([]),[l,o]=(0,r.useState)({name:"",status:"",address:"",tourist_site_id:0}),[m,p]=(0,r.useState)(null),[g,h]=(0,r.useState)(!1),[x,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("token");if(!e)return void c().fire("خطأ","الرجاء تسجيل الدخول أولاً.","error");f(e),b(e),v(e)},[]);let b=async e=>{h(!0);try{let a=await d.A.get("".concat(u.A,"/api/showAllHotel"),{headers:{Authorization:"Bearer ".concat(e)}});t(a.data.data||[])}catch(e){c().fire("خطأ","فشل في جلب الفنادق","error")}finally{h(!1)}},v=async e=>{try{let t=await d.A.get("".concat(u.A,"/api/getAllTouristSitesWithDetails"),{headers:{Authorization:"Bearer ".concat(e)}});s(t.data.data||[])}catch(e){c().fire("خطأ","فشل في جلب المواقع السياحية","error")}},y=async()=>{if(l.name.trim()&&x){h(!0);try{null!==m?(await d.A.put("".concat(u.A,"/api/updateHotel/").concat(m),l,{headers:{Authorization:"Bearer ".concat(x)}}),c().fire("نجاح","تم تعديل الفندق بنجاح","success")):(await d.A.post("".concat(u.A,"/api/addHotel"),l,{headers:{Authorization:"Bearer ".concat(x)}}),c().fire("نجاح","تمت إضافة الفندق بنجاح","success")),o({name:"",status:"",address:"",tourist_site_id:0}),p(null),b(x)}catch(e){c().fire("خطأ","حدثت مشكلة أثناء الحفظ","error")}finally{h(!1)}}},w=e=>{o({name:e.name,status:e.status,address:e.address,tourist_site_id:e.tourist_site_id}),p(e.id)},j=async e=>{if(x&&(await c().fire({title:"هل أنت متأكد؟",text:"لن تتمكن من التراجع عن هذا الإجراء!",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذف!",cancelButtonText:"إلغاء"})).isConfirmed){h(!0);try{await d.A.delete("".concat(u.A,"/api/deleteHotel/").concat(e),{headers:{Authorization:"Bearer ".concat(x)}}),c().fire("تم الحذف","تم حذف الفندق بنجاح","success"),b(x)}catch(e){c().fire("خطأ","فشل في حذف الفندق","error")}finally{h(!1)}}};return(0,n.jsxs)("div",{className:"max-w-3xl mx-auto p-4 md:p-8 bg-white shadow rounded-lg",dir:"rtl",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center text-blue-700",children:"إدارة الفنادق"}),g&&(0,n.jsxs)("div",{className:"text-center my-4",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-4 border-blue-600 mx-auto"}),(0,n.jsx)("p",{className:"text-blue-600 mt-2",children:"جارٍ التحميل..."})]}),(0,n.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,n.jsx)("input",{type:"text",name:"name",placeholder:"اسم الفندق",value:l.name,onChange:e=>o({...l,name:e.target.value}),className:"border p-2 rounded w-full max-w-md"}),(0,n.jsx)("input",{type:"text",name:"address",placeholder:"العنوان",value:l.address,onChange:e=>o({...l,address:e.target.value}),className:"border p-2 rounded w-full max-w-md"}),(0,n.jsx)("input",{type:"text",name:"status",placeholder:"الحالة",value:l.status,onChange:e=>o({...l,status:e.target.value}),className:"border p-2 rounded w-full max-w-md"}),(0,n.jsxs)("select",{name:"tourist_site_id",value:l.tourist_site_id,onChange:e=>o({...l,tourist_site_id:Number(e.target.value)}),className:"border p-2 rounded w-full max-w-md text-gray-500",children:[(0,n.jsx)("option",{value:0,disabled:!0,children:"اختر الموقع السياحي"}),a.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsx)("button",{onClick:y,disabled:g,className:"w-full md:w-auto px-6 py-2 rounded text-white font-semibold transition ".concat(null!==m?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"," flex items-center justify-center gap-2"),children:null!==m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.uO9,{})," حفظ التعديلات"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.OiG,{})," إضافة فندق"]})}),(0,n.jsxs)("div",{className:"mt-10",children:[(0,n.jsx)("h3",{className:"text-xl font-bold mb-4",children:" قائمة الفنادق"}),0===e.length?(0,n.jsx)("p",{className:"text-gray-500",children:"لا توجد فنادق مضافة بعد."}):(0,n.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,n.jsxs)("div",{className:"p-4 rounded bg-gray-50 shadow-sm flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"اسم الفندق:"})," ",e.name]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"العنوان:"})," ",e.address]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"الموقع السياحي:"})," ",e.tourist_site_name||"غير محدد"]}),(0,n.jsxs)("p",{className:"text-sm font-medium text-blue-600",children:[(0,n.jsx)("strong",{children:"الحالة:"})," ",e.status]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)("button",{onClick:()=>w(e),disabled:g,className:"px-3 py-1 bg-yellow-500 hover:bg-yellow-600 text-white rounded flex items-center gap-1",children:[(0,n.jsx)(i.uO9,{})," تعديل"]}),(0,n.jsxs)("button",{onClick:()=>j(e.id),disabled:g,className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded flex items-center gap-1",children:[(0,n.jsx)(i.qbC,{})," حذف"]})]})]},e.id))})]})]})}var A=a(7212),B=a(6848);let C=[{key:"pending",label:" الطلبات المعلقة",color:"bg-yellow-100"},{key:"accepted",label:" الطلبات المقبولة",color:"bg-green-100"},{key:"rejected",label:" الطلبات المرفوضة",color:"bg-red-100"},{key:"paid",label:" الطلبات المدفوعة",color:"bg-blue-100"}];function _(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)("pending"),[l,i]=(0,r.useState)(!0),o=()=>{i(!0);let e="";switch(a){case"pending":default:e="".concat(u.A,"/api/Pending");break;case"accepted":e="".concat(u.A,"/api/Accepted");break;case"rejected":e="".concat(u.A,"/api/Rejected");break;case"paid":e="".concat(u.A,"/api/Paid")}d.A.get(e,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(e=>{var a;console.log("API response:",e.data),t((null==(a=e.data)?void 0:a.data)||e.data||[])}).catch(e=>{var t;console.error("Error fetching data:",(null==(t=e.response)?void 0:t.data)||e.message)}).finally(()=>i(!1))};(0,r.useEffect)(()=>{o()},[a]);let c=e=>{d.A.post("".concat(u.A,"/api/accept/").concat(e.id),{},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(()=>{o(),window.dispatchEvent(new Event("updatePending"))}).catch(e=>console.error("Error accepting:",e))},m=e=>{d.A.post("".concat(u.A,"/api/reject/").concat(e.id),{},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(()=>{o(),window.dispatchEvent(new Event("updatePending"))}).catch(e=>console.error("Error rejecting:",e))};if(l)return(0,n.jsx)("p",{className:"text-center text-gray-500",children:"⏳ جاري التحميل..."});let p=e.filter(e=>"pending"===e.status).length;return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto bg-white-50  rounded-lg p-8 mt-4",dir:"rtl",children:[(0,n.jsx)("div",{className:"flex justify-between gap-2 mb-6 overflow-x-auto",children:C.map(e=>(0,n.jsxs)("button",{onClick:()=>s(e.key),className:"flex-1 p-3 rounded-lg font-semibold transition-all whitespace-nowrap ".concat(a===e.key?"".concat(e.color," border-2 border-blue-500 text-blue-900"):"bg-gray-100 hover:bg-gray-200 text-gray-700"),children:[e.label,"pending"===e.key&&p>0&&(0,n.jsxs)("span",{className:"ml-1 text-sm text-red-800 font-bold",children:["(",p,")"]})]},e.key))}),(0,n.jsx)("div",{className:"flex flex-col gap-4",children:(0,n.jsx)(A.N,{children:0===e.length?(0,n.jsx)(B.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center text-gray-500",children:"لا توجد طلبات حالياً."},"empty"):e.map(e=>{var t,r;return e.trip_cost,e.number_of_people,e.group_trip.final_price,e.number_of_people,null==(t=e.attachments)||t.reduce((e,t)=>e+(t.price||0),0),e.total_cost,(0,n.jsxs)(B.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.4},className:" rounded-lg p-4 bg-gray-50 shadow-sm",children:[(0,n.jsxs)("h3",{className:"text-lg font-bold text-blue-800 mb-2",children:["\uD83E\uDDFE فاتورة ",e.id]}),(0,n.jsxs)("p",{children:["تاريخ الإنشاء: ",new Date(e.created_at).toLocaleDateString()]}),(0,n.jsx)("h4",{className:"font-semibold mt-3 text-green-700",children:"\uD83D\uDC64 بيانات العميل"}),(0,n.jsxs)("p",{children:["الاسم: ",e.user.FirstName]}),(0,n.jsxs)("p",{children:["رقم الهاتف: ",e.user.Number]}),(0,n.jsxs)("p",{children:["العنوان: ",e.user.Address]}),(0,n.jsx)("h4",{className:"font-semibold mt-3 text-purple-700",children:"\uD83D\uDDFA بيانات الرحلة"}),(0,n.jsxs)("p",{children:["الوجهة: ",e.group_trip.Destination_name]}),(0,n.jsxs)("p",{children:["عدد الأشخاص: ",e.number_of_people]}),(0,n.jsxs)("p",{children:["السعر للشخص: ",e.trip_cost," ل.س"]}),e.group_trip.discount_percentage>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{children:["نسبة الخصم: ",e.group_trip.discount_percentage,"%"]}),(0,n.jsxs)("p",{children:["السعر بعد الخصم للشخص: ",e.group_trip.final_price," ل.س"]}),(0,n.jsxs)("p",{className:"text-red-600 font-bold",children:["إجمالي الخصم:"," ",Number(e.trip_cost)*e.number_of_people-e.group_trip.final_price*e.number_of_people," ","ل.س"]})]}):null,e.attachments&&e.attachments.length>0&&(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsx)("h4",{className:"font-semibold text-black-700",children:"\uD83D\uDCCE المرفقات"}),(0,n.jsx)("ul",{className:"list-disc list-inside",children:e.attachments.map(e=>(0,n.jsxs)("li",{children:[e.name," - ",(0,n.jsxs)("span",{className:"",children:[e.price," ل.س"]})]},e.id))}),(0,n.jsxs)("p",{className:"mt-1 text-sm text-gray-700 font-bold",children:["إجمالي المرفقات:"," ",(0,n.jsxs)("span",{className:"font-bold",children:[e.attachments.reduce((e,t)=>e+(t.price||0),0)," ","ل.س"]})]})]}),(0,n.jsxs)("p",{className:"mt-3 text-lg font-bold text-black-700",children:["المجموع الكلي:"," ",e.group_trip.final_price*e.number_of_people+((null==(r=e.attachments)?void 0:r.reduce((e,t)=>e+(t.price||0),0))||0)," ","ل.س"]}),"pending"===a&&(0,n.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,n.jsx)("button",{onClick:()=>c(e),className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition",children:"قبول"}),(0,n.jsx)("button",{onClick:()=>m(e),className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition",children:"رفض"})]})]},e.id)})})})]})}var k=a(1134),S=a(1047);S.t1.register(S.PP,S.kc,S.E8,S.hE,S.m_,S.s$,S.FN,S.No,S.Bs);let E=[{key:"reservations",label:"إحصاءات الحجوزات"},{key:"revenue",label:"الإيرادات"}],I=[{key:"monthly",label:"الحجوزات الشهرية"},{key:"weekly",label:"حسب أيام الأسبوع"},{key:"seasonal",label:"حسب الفصول"},{key:"topTrips",label:"أكثر الرحلات إقبالاً"},{key:"forecast",label:"التوقعات القادمة"}],D=[{key:"monthly",label:"الإيرادات الشهرية"},{key:"yearly",label:"الإيرادات السنوية"},{key:"total",label:"الإيرادات الكلية"}];function T(){var e,t,a,s,l;let[i,o]=(0,r.useState)("reservations"),[m,p]=(0,r.useState)("monthly"),[g,h]=(0,r.useState)("monthly"),[x,f]=(0,r.useState)(null),[b,v]=(0,r.useState)(null),[y,w]=(0,r.useState)(null),[j,N]=(0,r.useState)(null),[A,B]=(0,r.useState)(null),[C,_]=(0,r.useState)([]),[S,T]=(0,r.useState)(!0),[P,z]=(0,r.useState)(null);(0,r.useEffect)(()=>{{let e=localStorage.getItem("token");console.log("\uD83C\uDFAF Token from localStorage:",e),z(e)}},[]);let U=async()=>{if(P)try{await d.A.post("".concat(u.A,"/api/train"),{},{headers:{Authorization:"Bearer ".concat(P)}}),console.log("✅ تم تدريب النموذج بنجاح عند منتصف الليل")}catch(n){var e,t,a;console.error("❌ خطأ أثناء تدريب النموذج:",(null==(e=n.response)?void 0:e.data)||n.message),c().fire("خطأ","فشل تدريب النموذج:\n".concat((null==(a=n.response)||null==(t=a.data)?void 0:t.message)||n.message),"error")}};if((0,r.useEffect)(()=>{let e;if(!P)return;let t=new Date,a=new Date(t);a.setHours(24,0,0,0);let n=a.getTime()-t.getTime(),r=window.setTimeout(async()=>{await U(),e=window.setInterval(U,864e5)},n);return()=>{window.clearTimeout(r),e&&window.clearInterval(e)}},[P]),(0,r.useEffect)(()=>{if(null!==P){if(!P){c().fire("خطأ","⚠️ الرجاء تسجيل الدخول أولاً.","error"),T(!1);return}(async()=>{try{console.log("\uD83D\uDE80 Sending requests with token:",P);let[e,t,a,n,r,s]=await Promise.all([d.A.get("".concat(u.A,"/api/overview"),{headers:{Authorization:"Bearer ".concat(P)}}),d.A.get("".concat(u.A,"/api/forecast"),{headers:{Authorization:"Bearer ".concat(P)}}),d.A.get("".concat(u.A,"/api/monthly"),{headers:{Authorization:"Bearer ".concat(P)}}),d.A.get("".concat(u.A,"/api/yearly"),{headers:{Authorization:"Bearer ".concat(P)}}),d.A.get("".concat(u.A,"/api/total"),{headers:{Authorization:"Bearer ".concat(P)}}),d.A.get("".concat(u.A,"/api/getAllGroupTrips"),{headers:{Authorization:"Bearer ".concat(P)}})]);f(e.data),v(t.data),w(a.data),N(n.data),B(r.data),_(Array.isArray(s.data)?s.data:[])}catch(a){var e,t;console.error("فشل جلب البيانات:",a.response||a.message),c().fire("خطأ","فشل في جلب البيانات:\n".concat((null==(t=a.response)||null==(e=t.data)?void 0:e.message)||a.message),"error")}finally{T(!1)}})()}},[P]),S)return(0,n.jsx)("div",{className:"text-center text-lg",children:"⏳ جارِ تحميل البيانات..."});if(!x)return(0,n.jsx)("div",{className:"text-center text-red-500",children:"⚠️ لم يتم جلب بيانات الإحصاءات"});let F=y?Object.keys(y.monthly_revenue).sort():[],O=y?Object.values(y.monthly_revenue):[],G={labels:F,datasets:[{label:"عدد الحجوزات",data:x.monthly?Object.values(x.monthly):[],backgroundColor:"rgba(54, 162, 235, 0.7)"}]},q={labels:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],datasets:[{label:"عدد الحجوزات",data:null!=(a=x.days_of_week)?a:[],backgroundColor:"rgba(255, 159, 64, 0.7)"}]},M=[x.seasons.winter,x.seasons.spring,x.seasons.summer,x.seasons.autumn],V=new Map(C.map(e=>[e.id,e.destination])),L=x.top_trips.map(e=>{var t;return null!=(t=V.get(e.group_trip_id))?t:"رحلة ".concat(e.group_trip_id)}),R=x.top_trips.map(e=>e.count),W=null!=(s=null==b||null==(e=b.forecast)?void 0:e.map(e=>e.month))?s:[],H=null!=(l=null==b||null==(t=b.forecast)?void 0:t.map(e=>e.forecast))?l:[],X={labels:j?j.yearly_revenue.map(e=>String(e.year)):[],datasets:[{label:"الإيرادات السنوية (ل.س)",data:j?j.yearly_revenue.map(e=>e.revenue):[],backgroundColor:"rgba(75, 192, 192, 0.7)"}]},$={labels:["الإيرادات الكلية"],datasets:[{label:"الإيرادات (ل.س)",data:A?[A.total_revenue]:[],backgroundColor:"rgba(255, 206, 86, 0.7)"}]};return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto bg-white shadow-md rounded-lg p-6 mt-6",dir:"rtl",children:[(0,n.jsx)("div",{className:"flex gap-2 mb-6",children:E.map(e=>(0,n.jsx)("button",{onClick:()=>o(e.key),className:"flex-1 p-3 rounded-lg font-semibold transition ".concat(i===e.key?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.key))}),"reservations"===i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex gap-2 mb-6",children:I.map(e=>(0,n.jsx)("button",{onClick:()=>p(e.key),className:"flex-1 px-3 py-2 rounded-lg text-sm font-semibold transition ".concat(m===e.key?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.key))}),(0,n.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg shadow-inner",children:["monthly"===m&&(0,n.jsx)(k.yP,{data:G}),"weekly"===m&&(0,n.jsx)(k.yP,{data:q}),"seasonal"===m&&(0,n.jsx)("div",{className:"w-[520px] h-[520px] mx-auto",children:(0,n.jsx)(k.Fq,{data:{labels:["الشتاء","الربيع","الصيف","الخريف"],datasets:[{data:M,backgroundColor:["rgba(54, 162, 235, 0.7)","rgba(75, 192, 192, 0.7)","rgba(255, 206, 86, 0.7)","rgba(153, 102, 255, 0.7)"]}]},options:{maintainAspectRatio:!1}})}),"topTrips"===m&&(0,n.jsx)(k.yP,{data:{labels:L,datasets:[{label:"عدد الحجوزات",data:R,backgroundColor:"rgba(255, 99, 132, 0.7)"}]}}),"forecast"===m&&(W.length?(0,n.jsx)(k.N1,{data:{labels:W,datasets:[{label:"الحجوزات المتوقعة",data:H,borderColor:"rgba(54, 162, 235, 1)",backgroundColor:"rgba(54, 162, 235, 0.3)",tension:.3,fill:!0}]}}):(0,n.jsx)("div",{className:"text-center text-gray-500",children:"لا توجد بيانات توقعات متاحة حالياً"}))]})]}),"revenue"===i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex gap-2 mb-6",children:D.map(e=>(0,n.jsx)("button",{onClick:()=>h(e.key),className:"flex-1 px-3 py-2 rounded-lg text-sm font-semibold transition ".concat(g===e.key?"bg-purple-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.key))}),(0,n.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg shadow-inner",children:["monthly"===g&&(0,n.jsx)(k.yP,{data:{labels:F,datasets:[{label:"الإيرادات الشهرية (ل.س)",data:O,backgroundColor:"rgba(54, 162, 235, 0.7)"}]}}),"yearly"===g&&(0,n.jsx)(k.yP,{data:X}),"total"===g&&(0,n.jsx)(k.yP,{data:$})]})]})]})}function P(){let[e,t]=(0,r.useState)("statistics"),[a,o]=(0,r.useState)(!1),c=(0,s.useRouter)();return(0,r.useEffect)(()=>{localStorage.getItem("user")||c.push("/login")},[]),(0,n.jsxs)("div",{className:"flex h-screen overflow-hidden relative",children:[(0,n.jsx)("button",{onClick:()=>o(!a),className:"md:hidden fixed top-0 left-2 z-30 bg-gray-200 block-white px-4 py-2 rounded shadow-lg",children:(0,n.jsx)(i.OXb,{})}),(0,n.jsx)(l.default,{setActiveTab:e=>{t(e),o(!1)},isOpen:a,onClose:()=>o(!1)}),(0,n.jsx)("main",{className:"flex-1 md:mr-64 overflow-y-auto p-6 bg-gray-50 mt-2",children:"users"===e?(0,n.jsx)(m,{}):"employees"===e?(0,n.jsx)(p,{}):"locations"===e?(0,n.jsx)(g,{}):"groups"===e?(0,n.jsx)(f,{}):"governorates"===e?(0,n.jsx)(h,{}):"activities"===e?(0,n.jsx)(b,{}):"challenges"===e?(0,n.jsx)(v,{}):"suggestions"===e?(0,n.jsx)(w,{}):"restaurants"===e?(0,n.jsx)(j,{}):"hotels"===e?(0,n.jsx)(N,{}):"reservations"===e?(0,n.jsx)(_,{}):"statistics"===e?(0,n.jsx)(T,{}):"account"===e?(0,n.jsx)(y,{}):(0,n.jsx)("div",{className:"text-2xl text-center mt-20",children:"اختر عنصرًا من القائمة"})})]})}},2226:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n="http://localhost:8000"},6760:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(1727)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[938,390,697,493,661,636,593,792],()=>t(6760)),_N_E=e.O()}]);